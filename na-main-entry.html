<!DOCTYPE html>
<html>
<head>
  <title>Redirecting...</title>
  <meta charset="utf-8" />
  <script>
    async function redirectWithHash() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");

      if (!id) {
        document.body.innerHTML = "<h2>Error: No ID provided in URL.</h2>";
        return;
      }

      // Hash the ID
      const enc = new TextEncoder().encode(id);
      const hashBuffer = await crypto.subtle.digest("SHA-256", enc);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      const hashHex = hashArray.map(b => b.toString(16).padStart(2, "0")).join("");

      // Google Form entry fields and URLs
      const mainFormEntryField = "entry.318794376"; // Replace with your main form field
      const drawEntryField = "entry.UNHASHED_ID_FIELD"; // Replace with your entry form field

      const mainFormURL = "https://docs.google.com/forms/d/e/YOUR_NA_MAIN_FORM/viewform";
      const entryFormURL = "https://docs.google.com/forms/d/e/YOUR_ENTRY_FORM/viewform";

      // Auxiliary forms with their individual entry fields
      const auxForms = [
        {
          url: "https://docs.google.com/forms/d/e/AUX1/viewform",
          field: "entry.111111111"
        },
        {
          url: "https://docs.google.com/forms/d/e/AUX2/viewform",
          field: "entry.222222222"
        },
        {
          url: "https://docs.google.com/forms/d/e/AUX3/viewform",
          field: "entry.333333333"
        },
        {
          url: "https://docs.google.com/forms/d/e/AUX4/viewform",
          field: "entry.444444444"
        }
      ];

      // Build main survey URL
      const mainForm = `${mainFormURL}?${mainFormEntryField}=${hashHex}`;

      // Pick a random auxiliary form
      const chosenAux = auxForms[Math.floor(Math.random() * auxForms.length)];
      const auxForm = `${chosenAux.url}?${chosenAux.field}=${hashHex}`;

      // Build entry form URL
      const entryForm = `${entryFormURL}?${drawEntryField}=${id}`;

      // Redirect sequence
      window.location.href = mainForm;

      setTimeout(() => {
        window.location.href = auxForm;
      }, 5000);

      setTimeout(() => {
        window.location.href = entryForm;
      }, 10000);
    }

    redirectWithHash();
  </script>
</head>
<body>
  <h2>Redirecting to your survey...</h2>
</body>
</html>
