<!DOCTYPE html>
<html>
<head>
  <title>Redirecting...</title>
  <meta charset="utf-8" />
  <script>
    async function redirectWithHash() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");

      if (!id) {
        document.body.innerHTML = "<h2>Error: No ID provided in URL.</h2>";
        return;
      }

      // Hash the ID
      const enc = new TextEncoder().encode(id);
      const hashBuffer = await crypto.subtle.digest("SHA-256", enc);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      const hashHex = hashArray.map(b => b.toString(16).padStart(2, "0")).join("");

      // Google Form entry fields and URLs
      const mainFormEntryField = "entry.426302739"; // Replace with your main form field
      const drawEntryField = "entry.2146362662"; // Replace with your entry form field

      const mainFormURL = "https://docs.google.com/forms/d/e/1FAIpQLSdD_gxc5ur1bewa5n5dpiKO_EgprnWF22W7i45Uq-Qz_h0t-w/viewform";
      const entryFormURL = "https://docs.google.com/forms/d/e/1FAIpQLSfjtLVPjDh8dxrGcRnBU_kwHCwkOOd-Jebv5NuNI3ImRHUIuA/viewform";

      // Auxiliary forms with their individual entry fields
      const auxForms = [
        {
          url: "https://docs.google.com/forms/d/e/1FAIpQLSf0dvUWZKw8RL6lt4TvqCf48CYgXPDM9PfV-7IM1WYPA9ppKQ/viewform",
          field: "entry.264515739"
        },
        {
          url: "https://docs.google.com/forms/d/e/1FAIpQLSfmHNn31XjTppHwDyr6ZdpOEfK0oDBs4Og4b7-T75sFB65guA/viewform",
          field: "entry.1996828059"
        },
        {
          url: "https://docs.google.com/forms/d/e/1FAIpQLSeZmXgFOeC63o-iS50qIDlomp728XZVwOkMLG_0RvPk1OPWzA/viewform",
          field: "entry.561658891"
        },
        {
          url: "https://docs.google.com/forms/d/e/1FAIpQLScaj3sZAYdg5ToggZAQOTHXpGvr9cwutCIdMUvNNBd_098_EQ/viewform",
          field: "entry.1736154437"
        }
      ];

      // Build main survey URL
      const mainForm = `${mainFormURL}?${mainFormEntryField}=${hashHex}`;

      // Pick a random auxiliary form
      const chosenAux = auxForms[Math.floor(Math.random() * auxForms.length)];
      const auxForm = `${chosenAux.url}?${chosenAux.field}=${hashHex}`;

      // Build entry form URL
      const entryForm = `${entryFormURL}?${drawEntryField}=${id}`;

      // Redirect sequence
      window.location.href = mainForm;

      setTimeout(() => {
        window.location.href = auxForm;
      }, 5000);

      setTimeout(() => {
        window.location.href = entryForm;
      }, 10000);
    }

    redirectWithHash();
  </script>
</head>
<body>
  <h2>Redirecting to your survey...</h2>
</body>
</html>
